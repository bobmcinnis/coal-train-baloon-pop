<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Greenport Express</title>
  <style>
    :root {
      --train-dark: #333;
      --train-body: #666;
      --train-light: #999;
      --accent: #2ecc71;
    }
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: black;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      touch-action: none;
    }
    #levelUpPopup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 2em;
      padding: 20px 40px;
      border-radius: 12px;
      display: none;
      z-index: 1000;
      text-align: center;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="levelUpPopup">Level Up!</div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Game state
    let gs = {
      score: 0,
      level: 1,
      pointer: {x: 0, y: 0},
      backgroundX: 0,
    };

    // Sounds
    const steamSlow = new Audio("steam-slow.mp3");
    const steamMedium = new Audio("steam-medium.mp3");
    const levelUpSound = new Audio("jackpot.wav"); // swapped
    const jackpotSound = new Audio("level-up.wav"); // swapped
    steamSlow.loop = true;
    steamMedium.loop = true;
    steamSlow.volume = 0.4;
    steamMedium.volume = 0.4;
    steamSlow.play();

    // Background
    const bgImg = new Image();
    bgImg.src = "background-woods.png";

    function drawBackground() {
      if (!bgImg.complete) return;
      const bgWidth = bgImg.width;
      const bgHeight = bgImg.height;
      const scale = canvas.height / bgHeight;
      const scaledWidth = bgWidth * scale;
      gs.backgroundX -= 2;
      if (gs.backgroundX <= -scaledWidth) gs.backgroundX = 0;
      ctx.drawImage(bgImg, gs.backgroundX, 0, scaledWidth, canvas.height);
      ctx.drawImage(bgImg, gs.backgroundX + scaledWidth, 0, scaledWidth, canvas.height);
    }

    // Handle pointer
    canvas.addEventListener("pointermove", e => {
      gs.pointer.x = e.clientX;
      gs.pointer.y = e.clientY;
    });

    // Show Level Up Popup
    function showLevelUpPopup() {
      const popup = document.getElementById("levelUpPopup");
      popup.style.display = "block";
      setTimeout(() => {
        popup.style.display = "none";
      }, 3000); // stays visible 3 seconds
    }
    // Wheels + Train
    function drawWheel(cx, cy, r) {
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI * 2);
      ctx.fillStyle = getVar('--train-dark');
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.6, 0, Math.PI * 2);
      ctx.fillStyle = getVar('--train-light');
      ctx.fill();
    }

    function getVar(v) {
      return getComputedStyle(document.documentElement).getPropertyValue(v);
    }

    function drawTrain() {
      const w = canvas.width;
      const h = canvas.height;
      const baseY = h * 0.7;

      // body
      ctx.fillStyle = getVar('--train-body');
      ctx.fillRect(w * 0.1, baseY - h * 0.1, w * 0.3, h * 0.1);

      // cabin
      ctx.fillStyle = getVar('--train-dark');
      ctx.fillRect(w * 0.35, baseY - h * 0.2, w * 0.15, h * 0.2);

      // wheels
      drawWheel(w * 0.15, baseY, h * 0.05);
      drawWheel(w * 0.3, baseY, h * 0.05);
      drawWheel(w * 0.4, baseY, h * 0.05);
    }

    // Game update
    function update() {
      gs.score++;
      if (gs.score === 500) {
        steamSlow.pause();
        steamMedium.play();
      }
      if (gs.score % 1000 === 0) {
        gs.level++;
        levelUpSound.play();
        showLevelUpPopup();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground();
      drawTrain();

      // Score
      ctx.fillStyle = "white";
      ctx.font = "bold 24px sans-serif";
      ctx.fillText("Score: " + gs.score, 20, 40);
      ctx.fillText("Level: " + gs.level, 20, 70);
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
